<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"/>
        <link rel="stylesheet" type="text/css" href="css/styles.css"/>            
    </head>
    <body class="green">

        <div class="block">
            <p>Look at this pretty nav bar, fully Cobalt powered !</p>

            <p>Tap on bar buttons and watch below, buttons names should appears</p>
        </div>
        <div id="barLog" class="block" style="padding:5px; background:#CCC; min-height: 40px;">

        </div>
        <div class="block">
            <p>You can show/hide the bar and toggle button visibility too</p>

            <a href="javascript:;" id="showHideBars">change native bars visibility</a>
            <a href="javascript:;" class="showHideButton" data-button-name="moon">show/hide the moon</a>
            <a href="javascript:;" class="showHideButton" data-button-name="sun">show/hide the sun</a>
            <a href="javascript:;" class="showHideButton" data-button-name="wind">show/hide the wind</a>
            <a href="javascript:;" class="showHideButton" data-button-name="cloudy">show/hide the clouds</a>
            <a href="javascript:;" class="showHideButton" data-button-name="black_sun">show/hide the black sun</a>
        </div>

        <div class="block">
            <p>You can also change titles</p>

            <a href="javascript:;" id="changeTitles">change page title and wind title.</a>
        </div>
        
        <div class="block">
            <p>And set bars dynamically.</p>
            
            <a href="javascript:;" id="setBarsVisible">Show bottom bar</a>
            <a href="javascript:;" id="setBarContent">Set bar content</a>
            <a href="javascript:;" id="setBars">Set bars</a>
            <a href="javascript:;" id="pushWithBars">Push a page with bars</a>
        </div>


        <script type="text/javascript" src="js/zepto.min.js"></script>
        <script type="text/javascript" src="../platform/cobalt.js"></script>
        <script type="text/javascript" src="js/app.js"></script>


        <script>
            var badge = 0;
            
            var cloudyActionCfgs = [{
                iosIcon: "cloudy.png",
                color: "888888"
            },
            {
                icon: "fa fa-bolt",
                color: "FF0"
            },
            {
                title: "Clouds are coming",
                color: "000000"
            }]
            var cloudyActionCfgActive = undefined
        
            var barLog = function(str){
                $('#barLog').append(str+'<br/>');
            }
            var visibilities = [
                { top : true, bottom:true },
                { top : false, bottom:true },
                { top : false, bottom:false },
                { top : true, bottom:false }
            ]
            var visibilitiesIndex=0;

            Zepto(function($){

                cobalt.init({
                    debug:app.debug,
                    debugInBrowser:app.debugInBrowser,
                    debugInDiv:false
                });

                cobalt.nativeBars.setEventListener(function(item, event){
                    switch(item){
                        case "black_sun":
                            barLog("black sun");
                            break;
                        case "cloudy":
                            barLog('Oh no, clouds again !');
                            switch(cloudyActionCfgActive) {
                            case 0:
                                content = cloudyActionCfgs[1]
                                cloudyActionCfgActive = 1
                                break;
                            case 1:
                                content = cloudyActionCfgs[2]
                                cloudyActionCfgActive = 2
                                break;
                            case 2:
                            default:
                                content = cloudyActionCfgs[0]
                                cloudyActionCfgActive = 0
                                break;
                            }

                            cobalt.send({
                                type: "ui",
                                control: "bars",
                                data: {
                                    action: "setActionContent",
                                    name: item,
                                    content: content
                                }
                            });
                            break;
                        case "moon":
                            barLog('Moon is the queen !');
                            break;
                        case "sun":
                            barLog("Sun is the button's king !");
                            break;
                        case "wind":
                            barLog('Wind !');
                            badge++;
                            cobalt.send({
                                type: "ui",
                                control: "bars",
                                data: {
                                    action: "setActionBadge",
                                    name: item,
                                    badge: badge.toString()
                                }
                            });
                            break;
                        default :
                            barLog('An unknown button has been pressed.');
                            break;
                    }
                });

                app.initPage('native bars');

                app.touch('#showHideBars',function(){
                    var newVisibility = visibilities[visibilitiesIndex];
                    cobalt.toast('setting bar visibility to ', newVisibility);
                    cobalt.nativeBars.setVisibility(newVisibility);
                    visibilitiesIndex = ( visibilitiesIndex+1 < visibilities.length ) ? visibilitiesIndex+1 : 0;
                })

                app.touch('.showHideButton',function(){
                    console.log($(this));
                    var button = $(this).attr('data-button-name');
                    if ($(this).hasClass('buttonShown')){
                        cobalt.toast('hiding button');
                        cobalt.nativeBars.hideButton(button);
                        $(this).removeClass('buttonShown')
                    }else{
                        cobalt.toast('showing button');
                        cobalt.nativeBars.showButton(button);
                        $(this).addClass('buttonShown')
                    }
                })

                app.touch('#changeTitles',function(){
                   cobalt.nativeBars.setTexts({
                       title : "new page title",
                       wind : "new wind text"
                   });
                })
                
                app.touch('#pushWithBars',function(){
                    cobalt.navigate.push({
                        page: "nativeBars.html",
                        controller: "nativeBars",
                        bars: {
                        visible: {
                            top: true,
                            bottom: true
                        },
                        backgroundColor: "#4444FF",
                        color: "000",
                        title: "Pushed",
                        actions: [{
                                name: "sun",
                                title: "Sun !",
                                androidPosition: "top",
                                iosPosition: "topRight",
                                androidIcon: "fr.cobaltians.cobaltcatalog:sun",
                                iosIcon: "sun.png"
                            },
                            {
                                name: "cloudy",
                                title: "Clouds are coming",
                                iosPosition: "bottom",
                                androidPosition: "bottom",
                                androidIcon: "fr.cobaltians.cobaltcatalog:cloudy",
                                iosIcon: "cloudy.png"
                            }]
                        }
                    });
                });
                
                app.touch('#setBarsVisible',function(){
                    cobalt.send({
                        type: "ui",
                        control: "bars",
                        data: {
                            action: "setBarsVisible",
                            visible: {
                                bottom: true
                            }
                        }
                    });
                });
                
                app.touch('#setBarContent',function(){
                    cobalt.send({
                        type: "ui",
                        control: "bars",
                        data: {
                            action: "setBarContent",
                            content: {
                                backgroundColor: "#4444FF",
                                color: "FFF",
                                title: "Content set"
                            }
                        }
                    });
                });
                  
                app.touch('#setBars',function(){
                    cobalt.send({
                        type: "ui",
                        control: "bars",
                        data: {
                            action: "setBars",
                            bars: {
                                visible: {
                                    top: true
                                },
                                backgroundColor: "#44FF44",
                                color: "888",
                                title: "Bars set",
                                actions: [{
                                    name: "sun",
                                    title: "Sun !",
                                    androidPosition: "top",
                                    iosPosition: "topRight",
                                    androidIcon: "fr.cobaltians.cobaltcatalog:sun",
                                    iosIcon: "sun.png"
                                }]
                            }
                        }
                    });
                });
            })


        </script>

    </body>
</html>